// app/ui/toolbar.js
import { toggleTheme } from '../utils/theme.js';
import { getLocale } from '../data/locales.js';
import { applyDirection } from '../utils/rtl.js';
import { setStoredLang, getStoredLang } from '../utils/storage.js';

export function renderToolbar(container) {
    // -----------------------------------------------------------------
    // 1Ô∏è‚É£  Empty the container (in case this runs more than once)
    // -----------------------------------------------------------------
    container.innerHTML = '';

    // -----------------------------------------------------------------
    // 2Ô∏è‚É£  Detect page direction (ltr / rtl) ‚Äì only needed for the tooltip
    // -----------------------------------------------------------------
    const isRtl = document.documentElement.getAttribute('dir') === 'rtl';

    /* -----------------------------------------------------------------
       3Ô∏è‚É£  Create the three icons (Home, Theme, Help)
       ----------------------------------------------------------------- */
    const homeBtn = document.createElement('button');
    homeBtn.id = 'homeBtn';
    homeBtn.title = 'Home';
    homeBtn.textContent = 'üè†';
    homeBtn.classList.add('toolbar-btn');
    homeBtn.setAttribute('role', 'button');               // ‚Üê ARIA role
    homeBtn.appendChild(document.createElement('span')).className = 'sr-only';
    homeBtn.lastChild.textContent = 'Home';
    homeBtn.onclick = () => {
        window.router.navigate(`/${getStoredLang()}/`, true);
    };

    const themeBtn = document.createElement('button');
    themeBtn.id = 'themeToggle';
    themeBtn.title = getLocale(getStoredLang()).toggleTheme ||
        'Toggle light/dark mode';
    themeBtn.textContent = 'üåô';
    themeBtn.classList.add('toolbar-btn');
    themeBtn.setAttribute('role', 'button');               // ‚Üê ARIA role
    themeBtn.appendChild(document.createElement('span')).className = 'sr-only';
    themeBtn.lastChild.textContent = getLocale(getStoredLang()).toggleTheme || 'Toggle theme';
    themeBtn.onclick = toggleTheme;

    const helpBtn = document.createElement('button');
    helpBtn.id = 'helpBtn';
    helpBtn.title = getLocale(getStoredLang()).helpHeader || 'Help';
    helpBtn.textContent = '‚ùì';
    helpBtn.classList.add('toolbar-btn');
    helpBtn.setAttribute('role', 'button');               // ‚Üê ARIA role
    helpBtn.appendChild(document.createElement('span')).className = 'sr-only';
    helpBtn.lastChild.textContent = getLocale(getStoredLang()).helpHeader || 'Help';
    helpBtn.onclick = () => {
        window.router.navigate(`/${getStoredLang()}/help`, true);
    };

    // -----------------------------------------------------------------
    // 4Ô∏è‚É£  Two containers ‚Äì one for Home, one for Theme+Settings
    // -----------------------------------------------------------------
    const leftContainer = document.createElement('div');
    leftContainer.style.display = 'flex';
    leftContainer.style.alignItems = 'center';
    leftContainer.appendChild(homeBtn); // Home stays on the ‚Äústart‚Äù side

    const rightContainer = document.createElement('div');
    rightContainer.style.display = 'flex';
    rightContainer.style.alignItems = 'center';
    rightContainer.style.gap = '0.5rem';
    rightContainer.appendChild(themeBtn);
    rightContainer.appendChild(helpBtn);
    // rightContainer.appendChild(settingsBtn); // Theme & Settings together

    // -----------------------------------------------------------------
    // 5Ô∏è‚É£  Assemble the toolbar ‚Äì space‚Äëbetween pushes the containers apart
    // -----------------------------------------------------------------
    const toolbar = document.createElement('header');
    toolbar.id = 'toolbar';
    toolbar.className = 'toolbar';
    toolbar.style.display = 'flex';
    toolbar.style.justifyContent = 'space-between';
    toolbar.style.alignItems = 'center';
    toolbar.appendChild(leftContainer);
    toolbar.appendChild(rightContainer);

    // -----------------------------------------------------------------
    // 6Ô∏è‚É£  Insert the toolbar into the supplied container
    // -----------------------------------------------------------------
    container.appendChild(toolbar);
}